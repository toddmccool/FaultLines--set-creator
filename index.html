<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Faultlines Setlist Maker</title>
    <style>
      html,
      body {
        height: 100%; /* Full viewport height */
        margin: 0; /* No margins */
        padding: 0; /* No padding */
        background-image: url("fll.jpg"); /* Background image */
        background-size: cover; /* Cover entire viewport */
        background-position: right 20% center; /* Positioning the background */
        background-repeat: no-repeat; /* No repeat */
      }
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      textarea,
      button,
      input {
        width: 90%;
        margin: 10px auto;
        display: block;
        background-color: black;
        color: white;
      }
      #searchInput {
        margin-bottom: 0; /* Reduces space below the search input */
      }
      #listsContainer {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        flex-grow: 1;
      }
      #masterList,
      #setList {
        width: 100%;
        border: 1px solid black;
        padding: 10px;
        margin: 10px 0;
        height: 400px;
        overflow-y: auto;
        background-color: white;
      }
      .song {
        margin: 5px;
        padding: 5px;
        border: 1px solid grey;
        cursor: pointer;
        background-color: white;
      }
      .song:hover {
        background-color: lightgrey;
      }
      button[onclick="copySetlist()"] {
        margin-top: -200px; /* Adjust as necessary to bring it up by approximately three lines */
      }
      @media (min-width: 480px) {
        #masterList,
        #setList {
          width: 48%; /* Two columns on smaller screens */
          margin: 10px 1%; /* Small side margins for gutter space */
        }
        #listsContainer {
          justify-content: space-around;
        }
      }
      @media (min-width: 768px) {
        #masterList,
        #setList {
          width: 45%; /* Slightly larger than on smaller devices */
        }
      }
      @media (min-width: 1024px) {
        #listsContainer {
          justify-content: space-around;
        }
      }
      @media (max-width: 480px) {
        /* Specific styles for small devices like iPhones */
        textarea,
        button,
        input {
          font-size: 14px; /* Smaller font size for better readability */
        }
        #masterList,
        #setList {
          height: 200px; /* Further reduced height for very small screens */
        }
        button {
          padding: 8px; /* Adjust padding to make buttons easier to tap */
        }
      }
    </style>
  </head>
  <body>
    <input
      id="searchInput"
      type="text"
      placeholder="Search songs..."
      oninput="filterSongs()"
    />
    <textarea id="songInput" rows="10" cols="50">

      Ain’t Nobody/In The Air / 104 bpm capo 6
      Ain’t no mountain 129 bpm capo 0
      All My Lovin ballad version 156 bpm capo 4
      American Boy E 115 bpm capo 0
      American Girl D 115 bpm capo 0
      And I Love Her Beatles 113 bpm capo 0 
      Animals Medley 148 bpm capo 0
      Any way you want it capo 0 138 bpm
      Are You Gonna Be My Girl 105 bpm capo 2
      As It Was 174 bpm capo 0
      At Last 87 bpm capo 0
      Baby its cold outside 86 bpm G capo 3
      Bad Habits 126 bpm capo 2
      Bad bad Leroy Brown 148 bpm capo 3
      Believe E _Do you believe in life after love Cher  133 bpm capo 0 
      Benny and the Jets 72 bpm capo 0
      Best Day Of My Life 100 bpm capo 1
      Billie Jean 120 bpm capo 0
      Black Velvet Emi 85 bpm capo 0
      Blackbird 94 bpm capo 0
      Blackhorse and a cherry tree 105 bpm capo 0
      Bless the broken road  68 bpm capo 0
      Blister In The Sun 97 bpm capo 0
      Brandy 125 bpm capo 0
      We are family 116 bpm capo 0
      We are family 116 bpm capo 0
      We are family 116 bpm capo 0
      We are family 116 bpm capo 0
      We are family 116 bpm capo 0
      We are family 116 bpm capo 0
      We are family 116 bpm capo 0
      We are family 116 bpm capo 0
      We are family 116 bpm capo 0
      We are family 116 bpm capo 0
      We are family 116 bpm capo 0
      
  </textarea
    ><br />
    <button onclick="parseSongs()">Load Songs</button>
    <div id="listsContainer">
      <div id="masterList" tabindex="0"></div>
      <div id="setList"></div>
    </div>
    <div id="copysetList">
      <button onclick="copySetlist()">Copy Setlist</button>
    </div>
    <script>
      let originalSongs = [];
      let masterSongs = [];
      let setList = [];

      function parseSongs() {
        const input = document.getElementById("songInput").value.split("\n");
        originalSongs = input.map((line, index) => {
          const name = line.replace(/(\d+ bpm|capo \d+)/g, "").trim();
          const bpmMatch = line.match(/(\d+) bpm/);
          const bpm = bpmMatch ? parseInt(bpmMatch[1]) : null;
          const capoMatch = line.match(/capo (\d+)/);
          const capo = capoMatch ? parseInt(capoMatch[1]) : null;
          return { id: index, name, bpm, capo, originalIndex: index };
        });
        masterSongs = [...originalSongs];
        displaySongs("masterList", masterSongs);
        document.getElementById("songInput").style.display = "none";
        document.querySelector("button[onclick='parseSongs()']").style.display =
          "none";
      }

      function displaySongs(containerId, songs) {
        const container = document.getElementById(containerId);
        container.innerHTML = "";
        songs.forEach((song) => {
          const songDiv = document.createElement("div");
          songDiv.className = "song";
          songDiv.textContent = `${song.name} ${
            song.bpm ? "- " + song.bpm + " bpm" : ""
          } ${song.capo !== null ? "- capo " + song.capo : ""}`;
          songDiv.onclick = () => {
            containerId === "masterList"
              ? selectSong(song)
              : deselectSong(song);
          };
          container.appendChild(songDiv);
        });
      }

      function filterSongs() {
        const searchText = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const filteredSongs = originalSongs.filter((song) =>
          song.name.toLowerCase().includes(searchText)
        );
        displaySongs("masterList", filteredSongs);
      }

      function selectSong(song) {
        setList.push(song);
        masterSongs = masterSongs.filter((s) => s.id !== song.id);
        updateSuggestions();
        displaySongs("setList", setList);
        displaySongs("masterList", masterSongs);
      }

      function deselectSong(song) {
        masterSongs.splice(song.originalIndex, 0, song);
        setList = setList.filter((s) => s.id !== song.id);
        updateSuggestions();
        displaySongs("setList", setList);
        displaySongs("masterList", masterSongs);
      }

      function moveSongUp(song) {
        const index = setList.indexOf(song);
        if (index > 0) {
          [setList[index - 1], setList[index]] = [
            setList[index],
            setList[index - 1],
          ];
          displaySongs("setList", setList);
        }
      }

      function updateSuggestions() {
        if (!setList.length) return;
        const lastSelectedSong = setList[setList.length - 1];

        masterSongs.sort((a, b) => {
          const capoMatchA = a.capo === lastSelectedSong.capo ? 0 : 100;
          const capoMatchB = b.capo === lastSelectedSong.capo ? 0 : 100;
          const bpmDiffA = Math.abs(a.bpm - lastSelectedSong.bpm);
          const bpmDiffB = Math.abs(b.bpm - lastSelectedSong.bpm);
          const exactMatchA = capoMatchA === 0 && bpmDiffA <= 3 ? 0 : 1;
          const exactMatchB = capoMatchB === 0 && bpmDiffB <= 3 ? 0 : 1;

          return (
            exactMatchA - exactMatchB ||
            capoMatchA - capoMatchB ||
            bpmDiffA - bpmDiffB
          );
        });

        displaySongs("masterList", masterSongs);
      }

      function copySetlist() {
        const setListSongs = setList
          .map(
            (song) =>
              `${song.name} - ${song.bpm ? song.bpm + " bpm" : ""} ${
                song.capo !== null ? "- capo " + song.capo : ""
              }`
          )
          .join("\n");
        navigator.clipboard.writeText(setListSongs).then(
          () => alert("McCool-i-fied Setlist copied to clipboard!"),
          (err) => console.error("Failed to copy setlist: ", err)
        );
      }
    </script>
  </body>
</html>
